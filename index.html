<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalkulator QFE, Bola Basah & Titik Embun STAMAR TENAU</title>
    <style>
        body {
            font-family: 'Times New Roman', serif;
            max-width: 550px; /* Ukuran maksimal lebar halaman */
            margin: 0px auto;
            padding: 30px;
            border: 2px solid #a0a0a0; /* Border abu-abu sedikit lebih gelap */
            border-radius: 15px;
            box-shadow: 0 0px 0px rgba(0,0,0,0.2); /* Bayangan lebih jelas */
            background-color: #f7f7f7; /* Background sedikit off-white */
            color: #333;
        }

        h2 {
            text-align: center;
            font-size: 20x; /* Ukuran judul lebih besar */
            margin-top: 0px;
	    margin-bottom: 15px;
            color: #004d99; /* Warna biru gelap untuk judul */
            font-weight: bold;
        }

        label {
            font-size: 18px; /* Ukuran label input lebih besar */
            display: block;
            margin-top: 10px; /* Jarak antar label */
            font-weight: bold; /* Label input bold */
            color: #444;
        }

        input[type="number"] {
            width: calc(100% - 24px); /* Sesuaikan lebar input dengan padding */
            padding: 10px; /* Padding input lebih besar */
            font-size: 18px; /* Ukuran font input lebih besar */
            margin-top: 0px;
            border: 1px solid #bbb;
            border-radius: 8px;
            box-sizing: border-box; /* Pastikan padding termasuk dalam lebar */
        }
        
        input[type="number"]:focus {
            border-color: #007bff;
            outline: none;
            box-shadow: 0 0 8px rgba(0, 123, 255, 0.4);
        }

        button {
            margin-top: 15px; /* Jarak atas tombol */
            width: 100%;
            padding: 10px; /* Padding tombol lebih besar */
            font-size: 20px; /* Ukuran font tombol lebih besar */
            font-family: 'Times New Roman', serif;
            cursor: pointer;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 8px;
            transition: background-color 0.3s ease, transform 0.1s ease;
            font-weight: bold; /* Tombol bold */
            box-shadow: 0 4px 8px rgba(0, 123, 255, 0.3);
        }

        button:hover {
            background-color: #0056b3;
            transform: translateY(-2px); /* Efek sedikit terangkat saat hover */
        }
        button:active {
            transform: translateY(0); /* Efek tombol ditekan */
        }

        .output {
            margin-top: 0px; /* Jarak antar hasil */
            font-size: 20px; /* Ukuran font hasil lebih besar */
            font-weight: bold; /* Hasil bold */
            color: #006400; /* Warna hijau tua untuk hasil */
            text-align: center;
            background-color: #e9f7ea; /* Background sedikit hijau muda untuk hasil */
            padding: 10px;
            border-radius: 8px;
        }

        #qfeResult { color: #000000; } /* Biru navy untuk QFE */
        #wetBulb { color: #000000; } /* Hijau gelap untuk Suhu Bola Basah */
        #dewPoint { color: #000000; } /* Ungu gelap untuk Titik Embun */


        .error-message {
            color: #dc3545; /* Merah untuk pesan error */
            font-size: 16px;
            margin-top: 15px;
            text-align: center;
            font-weight: bold;
        }

        .watermark {
            text-align: center;
            margin-top: 40px;
            font-size: 14px;
            color: #888;
        }
    </style>
</head>
<body>
    <h2>Kalkulator QFE, Bola Basah & Titik Embun STAMAR TENAU</h2>

    <label for="qff">QFF (hPa/mbar):</label>
    <input type="number" id="qff" placeholder="Contoh: 1012.8" step="0.1" required>

    <label for="elevation">Ketinggian Stasiun (meter):</label>
    <input type="number" id="elevation" placeholder="Contoh: 19" step="0.1" required>

    <label for="temp">Suhu Bola Kering(°C):</label>
    <input type="number" id="temp" placeholder="Contoh: 27.3" step="0.1" required>

    <label for="rh">Kelembapan/RH (%):</label>
    <input type="number" id="rh" placeholder="Contoh: 81" required>

    <button onclick="hitung()">Hitung</button>

    <div class="output" id="qfeResult"></div>
    <div class="output" id="wetBulb"></div>
    <div class="output" id="dewPoint"></div>
    <div class="error-message" id="errorMessage"></div>

    <div class="watermark">by Andi</div>

    <script>
        function hitung() {
            const QFF_val = document.getElementById("qff").value;
            const H_val = document.getElementById("elevation").value;
            const T_db_val = document.getElementById("temp").value;
            const RH_val = document.getElementById("rh").value;

            const errorMessageDiv = document.getElementById("errorMessage");
            errorMessageDiv.innerText = ""; // Bersihkan pesan error sebelumnya

            // Parsing nilai input
            const QFF = parseFloat(QFF_val);
            const H = parseFloat(H_val);
            const T_db = parseFloat(T_db_val);
            const RH = parseFloat(RH_val);

            // Validasi input
            if (isNaN(QFF) || isNaN(H) || isNaN(T_db) || isNaN(RH) || 
                QFF_val.trim() === '' || H_val.trim() === '' || T_db_val.trim() === '' || RH_val.trim() === '') {
                errorMessageDiv.innerText = "Mohon masukkan semua nilai numerik yang valid.";
                resetOutputLabels();
                return;
            }
            
            if (RH <= 0 || RH > 100) {
                errorMessageDiv.innerText = "Kelembaban Relatif (RH) harus antara 0.1% dan 100%.";
                resetOutputLabels();
                return;
            }
            if (H < 0) {
                errorMessageDiv.innerText = "Ketinggian tidak boleh negatif.";
                resetOutputLabels();
                return;
            }

            // --- Perhitungan Titik Embun (Td) ---
            // Rumus Magnus (disesuaikan dari kode Python Anda)
            const a_magnus = 17.27;
            const b_magnus = 237.7;
            
            // Handle log(0) atau log(negatif)
            if (RH === 0) { // Jika RH sangat kecil mendekati 0, log(0) tidak terdefinisi
                errorMessageDiv.innerText = "RH 0% akan menghasilkan Titik Embun tak hingga (minus).";
                resetOutputLabels();
                return;
            }
            const alpha = (a_magnus * T_db) / (b_magnus + T_db) + Math.log(RH / 100);
            const Td = (b_magnus * alpha) / (a_magnus - alpha);

            // --- Perhitungan Suhu Bola Basah (Tw) ---
            // Rumus bola basah disesuaikan (dari kalibrasi Anda sebelumnya)
            const Tw = T_db - 0.74 * (T_db - Td);

            // --- Perhitungan QFE dari QFF ---
            // Konstanta fisika
            const g = 9.80665; // Percepatan gravitasi (m/s^2)
            const R = 287.05;  // Konstanta gas spesifik untuk udara kering (J/(kg·K))

            // 1. Konversi Suhu Kering ke Kelvin
            const T_db_K = T_db + 273.15;

            // 2. Hitung Suhu Virtual (Tv)
            // Estimasi Tekanan Uap Jenuh (es) pada T_db
            const es_val = 6.112 * Math.exp((17.67 * T_db) / (T_db + 243.5));
            
            // Tekanan Uap Aktual (e)
            const e_val = (RH / 100) * es_val;

            // Rasio Pencampuran (r)
            // Cek untuk menghindari pembagian dengan nol atau nilai negatif
            if ((QFF - e_val) <= 0) {
                errorMessageDiv.innerText = "Tekanan uap aktual terlalu tinggi, tidak dapat menghitung rasio pencampuran yang valid untuk QFE.";
                resetOutputLabels();
                return;
            }
            const r_val = (0.622 * e_val) / (QFF - e_val);
            
            // Suhu Virtual (Tv)
            const T_v_val = T_db_K * (1 + 0.61 * r_val);

            // 3. Hitung QFE Menggunakan Rumus Barometrik
            const exponent = (-g * H) / (R * T_v_val);
            const QFE = QFF * Math.exp(exponent);

            // Tampilkan hasil
            document.getElementById("qfeResult").innerText = `QFE: ${QFE.toFixed(1)} mbar`;
            document.getElementById("wetBulb").innerText = `Suhu Bola Basah: ${Tw.toFixed(1)} °C`;
            document.getElementById("dewPoint").innerText = `Titik Embun: ${Td.toFixed(1)} °C`;
        }

        function resetOutputLabels() {
            document.getElementById("qfeResult").innerText = "";
            document.getElementById("wetBulb").innerText = "";
            document.getElementById("dewPoint").innerText = "";
        }

        // Tangani event keydown untuk semua input agar bisa menghitung dengan Enter atau Tab
        const inputs = document.querySelectorAll('input[type="number"]');
        inputs.forEach(input => {
            input.addEventListener("keydown", function(e) {
                if (e.key === "Enter") {
                    e.preventDefault(); // Mencegah form submit default
                    hitung();
                } else if (e.key === "Tab") {
                    // Biarkan perilaku default Tab untuk berpindah fokus, tapi juga hitung
                    // Ini akan memicu hitung() saat keluar dari input terakhir dengan Tab
                    // atau jika mereka menekan Tab di input mana pun (opsional)
                    // if (input.id === 'rh') { // Hanya hitung saat menekan Tab dari RH
                        hitung();
                    // }
                }
            });
        });

        // Pastikan hitung() terpanggil saat tombol diklik
        document.querySelector('button').addEventListener('click', hitung);
    </script>
</body>
</html>